const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('id');

if (!productId) {
  document.body.innerHTML = "<p style='color:red;'>Error: No product ID provided in URL.</p>";
  throw new Error("No product ID found");
}

fetch(`https://badger-orders.onrender.com/get-product-details/${productId}`)
  .then(res => res.json())
  .then(data => {
    const inner = data.result?.result;
    const product = inner?.sync_product;
    const variants = inner?.sync_variants;

    if (!product || !variants) {
      document.getElementById("result").innerText = "Product not found.";
      return;
    }

    document.getElementById("productImage").src = product.thumbnail_url;
    document.getElementById("productName").innerText = product.name;

    document.getElementById("productPrice").innerText = "Â£" + variants[0].retail_price + " (includes VAT, excludes shipping)";

    const sizeDropdown = document.getElementById("size");
    variants.forEach(variant => {
      const option = document.createElement("option");
      option.value = variant.variant_id;
      option.textContent = variant.size || variant.name;
      sizeDropdown.appendChild(option);
    });
  })
  .catch(err => {
    document.getElementById("result").innerText = "Failed to load product: " + err.message;
  });
